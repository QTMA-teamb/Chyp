<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/myfavicon.ico">
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Chyp</title>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>

    <script>
  	  // This is called with the results from from FB.getLoginStatus().
  	  function statusChangeCallback(response) {
  	    console.log('statusChangeCallback');
  	    console.log(response);
  	    // The response object is returned with a status field that lets the
  	    // app know the current login status of the person.
  	    // Full docs on the response object can be found in the documentation
  	    // for FB.getLoginStatus().
  	    if (response.status === 'connected') {
  	      // Logged into your app and Facebook.
  				// checkLoginState();
  	      testAPI();
  	    } else {
  	      // The person is not logged into your app or we are unable to tell.
  	      document.getElementById('status').innerHTML = 'Please log ' +
  	        'into this app.';
  	    }
  	  }

  	  // This function is called when someone finishes with the Login
  	  // Button.  See the onlogin handler attached to it in the sample
  	  // code below.
  	  function checkLoginState() {
  	    FB.getLoginStatus(function(response) {
  	      statusChangeCallback(response);
  	    });
  	  }

  	  window.fbAsyncInit = function() {
  	  FB.init({
  	    appId      : '360886547672323',
  	    cookie     : true,  // enable cookies to allow the server to access
  	                        // the session
  	    xfbml      : true,  // parse social plugins on this page
  	    version    : 'v2.8' // use graph api version 2.8
  	  });

  	  // Now that we've initialized the JavaScript SDK, we call
  	  // FB.getLoginStatus().  This function gets the state of the
  	  // person visiting this page and can return one of three states to
  	  // the callback you provide.  They can be:
  	  //
  	  // 1. Logged into your app ('connected')
  	  // 2. Logged into Facebook, but not your app ('not_authorized')
  	  // 3. Not logged into Facebook and can't tell if they are logged into
  	  //    your app or not.
  	  //
  	  // These three cases are handled in the callback function.

  	  FB.getLoginStatus(function(response) {
  			// checks if user already authorized
  	    if (response.status === 'connected') {
          FB.api('me?fields=id,name,email', function(user) {
  		       if(user != null) {
                username  = user.name;
                uid = user.id;
                email = user.email;

  							document.getElementById('lblLogin').innerHTML =
  				        'Thanks for logging in, ' + user.name + '!';
  							document.getElementById('btnLogin').style.display = 'none';
  	          }
          });

  	    }
  			else {
  	// If user is not authorized call FB.login for pop up window for authorization  , scope defines list of persmission requested with user
  	    FB.login(function(response) {
            if (response.authResponse.accessToken) {
              FB.api('me?fields=id,name,email', function(user) {
                  if(user != null) {
                    username  = user.name;
                    uid = user.id;
                    email = user.email;
                  }
              })
            }
        }, {scope:'email'});
  		}
  	    statusChangeCallback(response);
  	  });

  	  };

  	  // Load the SDK asynchronously
  	  (function(d, s, id){
  	            var js, fjs = d.getElementsByTagName(s)[0];
  	            if (d.getElementById(id)) {return;}
  	            js = d.createElement(s); js.id = id;
  	            js.src = "https://connect.facebook.net/en_US/sdk.js";
  	            fjs.parentNode.insertBefore(js, fjs);
  	          }(document, 'script', 'facebook-jssdk')
  	        );

  	  // Here we run a very simple test of the Graph API after login is
  	  // successful.  See statusChangeCallback() for when this call is made.
  	  function testAPI() {
  	    console.log('Welcome!  Fetching your information.... ');
  	    FB.api('/me', function(response) {
  				console.log("this is"+response.status);
  	      console.log('Successful login for: ' + response.name);
  				document.getElementById('lblLogin').innerHTML =
  					'Thanks for logging in, ' + response.name + '!';
  				document.getElementById('btnLogin').style.display = 'none';

  	    });
  	  }


  		function checkUser(){
  			FB.api('/me', function(response) {
  			if (response.name){
  				 window.location.href = 'new_index.html';
  			}
  			else
  			{
  				alert("Please Login With Facebook!");
  			}
  		});

  		}
  	</script>



  </body>
</html>
